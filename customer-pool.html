<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢æˆ·æ± ç®¡ç† - è¿è¥ç®¡æ§å°</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .sidebar {
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
        }

        .nav-item.active {
            background: rgba(82, 196, 26, 0.2);
            border-left-color: #52c41a;
        }

        .logo-icon {
            background: #52c41a;
        }

        /* ç»Ÿè®¡å¡ç‰‡åŒº */
        .pool-stats {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            border-left: 4px solid #e8e8e8;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .stat-card .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-card .stat-label {
            font-size: 13px;
            color: #8c8c8c;
        }

        .stat-card .stat-trend {
            font-size: 12px;
            margin-top: 6px;
        }

        .stat-card.total {
            border-left-color: #1890ff;
        }

        .stat-card.total .stat-value {
            color: #1890ff;
        }

        .stat-card.available {
            border-left-color: #52c41a;
        }

        .stat-card.available .stat-value {
            color: #52c41a;
        }

        .stat-card.marketing {
            border-left-color: #fa8c16;
        }

        .stat-card.marketing .stat-value {
            color: #fa8c16;
        }

        .stat-card.cooling {
            border-left-color: #722ed1;
        }

        .stat-card.cooling .stat-value {
            color: #722ed1;
        }

        .stat-card.loaned {
            border-left-color: #13c2c2;
        }

        .stat-card.loaned .stat-value {
            color: #13c2c2;
        }

        .stat-card.blacklist {
            border-left-color: #f5222d;
        }

        .stat-card.blacklist .stat-value {
            color: #f5222d;
        }

        /* ç­›é€‰æ  */
        .filter-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            background: #fff;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            flex-wrap: wrap;
        }

        .filter-bar select,
        .filter-bar input {
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            font-size: 13px;
            background: #fff;
            min-width: 140px;
        }

        .filter-bar input[type="text"] {
            min-width: 200px;
        }

        .filter-bar .filter-actions {
            margin-left: auto;
            display: flex;
            gap: 8px;
        }

        /* çŠ¶æ€æ ‡ç­¾ */
        .pool-status {
            display: inline-flex;
            align-items: center;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 500;
            gap: 4px;
        }

        .pool-status::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .pool-status.s-available {
            background: #f6ffed;
            color: #52c41a;
        }

        .pool-status.s-available::before {
            background: #52c41a;
        }

        .pool-status.s-locked {
            background: #fff7e6;
            color: #fa8c16;
        }

        .pool-status.s-locked::before {
            background: #fa8c16;
        }

        .pool-status.s-assigned {
            background: #e6f7ff;
            color: #1890ff;
        }

        .pool-status.s-assigned::before {
            background: #1890ff;
        }

        .pool-status.s-contacting {
            background: #fff0f6;
            color: #eb2f96;
        }

        .pool-status.s-contacting::before {
            background: #eb2f96;
        }

        .pool-status.s-interested {
            background: #f9f0ff;
            color: #722ed1;
        }

        .pool-status.s-interested::before {
            background: #722ed1;
        }

        .pool-status.s-credited {
            background: #e6fffb;
            color: #13c2c2;
        }

        .pool-status.s-credited::before {
            background: #13c2c2;
        }

        .pool-status.s-loaned {
            background: #d9f7be;
            color: #389e0d;
        }

        .pool-status.s-loaned::before {
            background: #389e0d;
        }

        .pool-status.s-rejected {
            background: #fff1f0;
            color: #f5222d;
        }

        .pool-status.s-rejected::before {
            background: #f5222d;
        }

        .pool-status.s-cooling {
            background: #efdbff;
            color: #722ed1;
        }

        .pool-status.s-cooling::before {
            background: #722ed1;
        }

        .pool-status.s-blacklisted {
            background: #ffa39e;
            color: #a8071a;
        }

        .pool-status.s-blacklisted::before {
            background: #a8071a;
        }

        /* è¡¨æ ¼å¢å¼º */
        .pool-table {
            width: 100%;
        }

        .pool-table th {
            font-size: 12px;
            color: #8c8c8c;
            font-weight: 600;
            text-transform: uppercase;
        }

        .pool-table td {
            font-size: 13px;
            vertical-align: middle;
        }

        .ent-name-cell {
            display: flex;
            flex-direction: column;
        }

        .ent-name-cell .name {
            font-weight: 600;
            color: #262626;
        }

        .ent-name-cell .code {
            font-size: 11px;
            color: #bfbfbf;
            margin-top: 2px;
        }

        .region-tag {
            display: inline-block;
            padding: 2px 8px;
            background: #f0f5ff;
            color: #2f54eb;
            border-radius: 4px;
            font-size: 11px;
            margin: 1px 2px;
        }

        .inst-tag {
            display: inline-block;
            padding: 2px 8px;
            background: #fff7e6;
            color: #d48806;
            border-radius: 4px;
            font-size: 12px;
        }

        .cooling-info {
            font-size: 12px;
            color: #722ed1;
        }

        .cooling-info .days-left {
            font-weight: 600;
        }

        .assign-count {
            font-weight: 600;
            color: #595959;
        }

        .reject-count {
            color: #f5222d;
            font-size: 12px;
        }

        /* è¯¦æƒ…æŠ½å±‰ */
        .drawer-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.45);
            z-index: 1000;
        }

        .drawer-overlay.active {
            display: block;
        }

        .drawer {
            position: fixed;
            top: 0;
            right: -520px;
            width: 520px;
            height: 100%;
            background: #fff;
            z-index: 1001;
            transition: right 0.3s ease;
            box-shadow: -4px 0 24px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
        }

        .drawer.active {
            right: 0;
        }

        .drawer-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid #f0f0f0;
        }

        .drawer-header h3 {
            font-size: 16px;
            margin: 0;
        }

        .drawer-close {
            cursor: pointer;
            font-size: 20px;
            color: #8c8c8c;
            background: none;
            border: none;
        }

        .drawer-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        /* æ—¶é—´çº¿ */
        .timeline {
            position: relative;
            padding-left: 24px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #f0f0f0;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 4px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #1890ff;
            background: #fff;
        }

        .timeline-item.success::before {
            border-color: #52c41a;
            background: #52c41a;
        }

        .timeline-item.warning::before {
            border-color: #fa8c16;
            background: #fa8c16;
        }

        .timeline-item.error::before {
            border-color: #f5222d;
            background: #f5222d;
        }

        .timeline-item .tl-time {
            font-size: 12px;
            color: #8c8c8c;
        }

        .timeline-item .tl-content {
            font-size: 13px;
            color: #262626;
            margin-top: 4px;
        }

        .timeline-item .tl-detail {
            font-size: 12px;
            color: #8c8c8c;
            margin-top: 2px;
        }

        /* ä¼ä¸šä¿¡æ¯å¤´ */
        .ent-header {
            margin-bottom: 24px;
        }

        .ent-header h4 {
            font-size: 18px;
            margin: 0 0 8px 0;
        }

        .ent-meta {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .ent-meta-item {
            font-size: 12px;
            color: #8c8c8c;
        }

        .ent-meta-item span {
            color: #262626;
            font-weight: 500;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #262626;
            margin: 20px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid #f0f0f0;
        }

        /* åˆ†é¡µ */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            font-size: 13px;
            color: #8c8c8c;
        }

        .page-btns {
            display: flex;
            gap: 4px;
        }

        .page-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            cursor: pointer;
            background: #fff;
            font-size: 13px;
            transition: all 0.2s;
        }

        .page-btn:hover {
            border-color: #1890ff;
            color: #1890ff;
        }

        .page-btn.active {
            background: #1890ff;
            color: #fff;
            border-color: #1890ff;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-logo">
                <div class="logo-icon">âš™ï¸</div>
                <h1>è¿è¥ç®¡æ§å°</h1>
            </div>
            
            <nav class="nav-menu">
                <a href="index.html" class="nav-item "><span class="nav-icon">ğŸ“Š</span><span class="nav-text">è¿è¥æ¦‚è§ˆ</span></a>
                
                <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 8px 16px;"></div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.45); padding: 8px 24px; margin-top: 4px;">æ•°æ®äº¤ä»˜</div>
                <a href="smart-search.html" class="nav-item "><span class="nav-icon">ğŸ¯</span><span class="nav-text">æ™ºèƒ½æ¢å®¢</span></a>
                <a href="batch-enrich.html" class="nav-item "><span class="nav-icon">ğŸ“‘</span><span class="nav-text">æ‰¹é‡ç”»åƒæŸ¥è¯¢</span></a>
                
                <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 8px 16px;"></div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.45); padding: 8px 24px; margin-top: 4px;">ä¸šåŠ¡ç®¡ç†</div>
                <a href="institutions.html" class="nav-item "><span class="nav-icon">ğŸ›ï¸</span><span class="nav-text">æœºæ„ç®¡ç†</span></a>
                <a href="customer-pool.html" class="nav-item active"><span class="nav-icon">ğŸŠ</span><span class="nav-text">å®¢æˆ·æ± </span></a>
                <a href="products.html" class="nav-item "><span class="nav-icon">ğŸ“¦</span><span class="nav-text">äº§å“é…ç½®</span></a>
                <a href="rules.html" class="nav-item "><span class="nav-icon">ğŸ¯</span><span class="nav-text">è§„åˆ™å¼•æ“</span></a>
                <a href="distribution.html" class="nav-item "><span class="nav-icon">ğŸ”€</span><span class="nav-text">åˆ†å‘ç®¡ç†</span></a>
                <a href="analytics.html" class="nav-item "><span class="nav-icon">ğŸ“ˆ</span><span class="nav-text">æ•ˆæœåˆ†æ</span></a>
                <a href="billing.html" class="nav-item "><span class="nav-icon">ğŸ’°</span><span class="nav-text">æ”¶è´¹ç»“ç®—</span></a>
                <a href="reconciliation.html" class="nav-item "><span class="nav-icon">ğŸ“‘</span><span class="nav-text">å¯¹è´¦ç®¡ç†</span></a>
                <a href="risk-alert.html" class="nav-item "><span class="nav-icon">âš ï¸</span><span class="nav-text">é£é™©é¢„è­¦</span></a>
                
                <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 8px 16px;"></div>
                <div style="font-size: 12px; color: rgba(255,255,255,0.45); padding: 8px 24px; margin-top: 4px;">ç³»ç»Ÿé…ç½®</div>
                <a href="api-monitor.html" class="nav-item "><span class="nav-icon">ğŸ”Œ</span><span class="nav-text">APIç›‘æ§</span></a>
                <a href="downloads.html" class="nav-item "><span class="nav-icon">ğŸ“¥</span><span class="nav-text">ä¸‹è½½ä¸­å¿ƒ</span></a>
            </nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" style="background: #52c41a;">ç®¡</div>
                    <div>
                        <div class="user-name">ç®¡ç†å‘˜</div>
                        <div class="user-role">å¹³å°è¿è¥</div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header" style="display:flex;justify-content:space-between;align-items:center;">
                <div>
                    <h2>å®¢æˆ·æ± ç®¡ç†</h2>
                    <div class="breadcrumb">è¿è¥ç®¡æ§å° / å®¢æˆ·æ± ç®¡ç†</div>
                </div>
                <div style="display:flex;gap:10px;">
                    <button class="btn btn-default" onclick="showCoolingConfig()">â± å†·å´æœŸé…ç½®</button>
                    <button class="btn btn-default" onclick="exportPool()">ğŸ“¥ å¯¼å‡º</button>
                </div>
            </div>

            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="pool-stats">
                <div class="stat-card total">
                    <div class="stat-value">324,186</div>
                    <div class="stat-label">æ€»å…¥æ± </div>
                    <div class="stat-trend" style="color:#52c41a;">â†‘ 1,240 ä»Šæ—¥æ–°å¢</div>
                </div>
                <div class="stat-card available">
                    <div class="stat-value">187,432</div>
                    <div class="stat-label">å¯åˆ†é…</div>
                    <div class="stat-trend" style="color:#52c41a;">å  57.8%</div>
                </div>
                <div class="stat-card marketing">
                    <div class="stat-value">52,318</div>
                    <div class="stat-label">è¥é”€ä¸­</div>
                    <div class="stat-trend" style="color:#fa8c16;">å«å·²åˆ†é… + è¥é”€ä¸­ + æ„å‘ä¸­</div>
                </div>
                <div class="stat-card cooling">
                    <div class="stat-value">31,056</div>
                    <div class="stat-label">å†·å´ä¸­</div>
                    <div class="stat-trend" style="color:#722ed1;">é¢„è®¡7æ—¥å†…é‡Šæ”¾ 4,200</div>
                </div>
                <div class="stat-card loaned">
                    <div class="stat-value">48,180</div>
                    <div class="stat-label">å·²æ”¾æ¬¾</div>
                    <div class="stat-trend" style="color:#13c2c2;">ç´¯è®¡ Â¥23.7äº¿</div>
                </div>
                <div class="stat-card blacklist">
                    <div class="stat-value">5,200</div>
                    <div class="stat-label">é»‘åå•</div>
                    <div class="stat-trend" style="color:#f5222d;">å  1.6%</div>
                </div>
            </div>

            <!-- ç­›é€‰æ  -->
            <div class="filter-bar">
                <select id="filterStatus">
                    <option value="">å…¨éƒ¨çŠ¶æ€</option>
                    <option value="AVAILABLE">å¯åˆ†é…</option>
                    <option value="LOCKED">å·²é”å®š</option>
                    <option value="ASSIGNED">å·²åˆ†é…</option>
                    <option value="CONTACTING">è¥é”€ä¸­</option>
                    <option value="INTERESTED">æ„å‘ä¸­</option>
                    <option value="CREDITED">å·²æˆä¿¡</option>
                    <option value="LOAN_SUCCESS">å·²æ”¾æ¬¾</option>
                    <option value="COOLING">å†·å´ä¸­</option>
                    <option value="BLACKLISTED">é»‘åå•</option>
                </select>
                <select id="filterRegion">
                    <option value="">å…¨éƒ¨åœ°åŒº</option>
                    <option value="320100">å—äº¬å¸‚</option>
                    <option value="320500">è‹å·å¸‚</option>
                    <option value="320200">æ— é”¡å¸‚</option>
                    <option value="320400">å¸¸å·å¸‚</option>
                    <option value="320600">å—é€šå¸‚</option>
                </select>
                <select id="filterInst">
                    <option value="">å…¨éƒ¨æœºæ„</option>
                    <option value="jsbank">æ±Ÿè‹é“¶è¡Œ</option>
                    <option value="njbank">å—äº¬é“¶è¡Œ</option>
                    <option value="szrcb">è‹å·å†œå•†è¡Œ</option>
                    <option value="xlA">æŸå°è´·å…¬å¸A</option>
                </select>
                <input type="text" id="searchInput" placeholder="æœç´¢ä¼ä¸šåç§° / ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ">
                <div class="filter-actions">
                    <button class="btn btn-primary btn-sm" onclick="applyFilter()">ç­›é€‰</button>
                    <button class="btn btn-default btn-sm" onclick="resetFilter()">é‡ç½®</button>
                </div>
            </div>

            <!-- ä¸»è¡¨æ ¼ -->
            <div class="card" style="padding:0;">
                <table class="table pool-table">
                    <thead>
                        <tr>
                            <th style="width:22%;">ä¼ä¸šä¿¡æ¯</th>
                            <th>åœ°åŒº</th>
                            <th>çŠ¶æ€</th>
                            <th>å½“å‰æœºæ„</th>
                            <th>åˆ†é…/æ‹’ç»</th>
                            <th>å†·å´æˆªæ­¢</th>
                            <th>æœ€è¿‘åˆ†é…</th>
                            <th style="width:15%;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="poolTableBody"></tbody>
                </table>
                <div class="pagination" style="padding:12px 20px;">
                    <span>å…± <strong>324,186</strong> æ¡è®°å½•ï¼Œå½“å‰ç¬¬ 1/16,210 é¡µ</span>
                    <div class="page-btns">
                        <div class="page-btn">Â«</div>
                        <div class="page-btn active">1</div>
                        <div class="page-btn">2</div>
                        <div class="page-btn">3</div>
                        <div class="page-btn">...</div>
                        <div class="page-btn">16210</div>
                        <div class="page-btn">Â»</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- è¯¦æƒ…æŠ½å±‰ -->
    <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
    <div class="drawer" id="detailDrawer">
        <div class="drawer-header">
            <h3 id="drawerTitle">ä¼ä¸šè¯¦æƒ…</h3>
            <button class="drawer-close" onclick="closeDrawer()">âœ•</button>
        </div>
        <div class="drawer-body" id="drawerBody"></div>
    </div>

    <!-- å†·å´æœŸé…ç½®å¼¹çª— -->
    <div class="modal-overlay" id="coolingModal">
        <div class="modal" style="max-width:560px;">
            <div class="modal-header">
                <h3>â± å†·å´æœŸé…ç½®</h3>
                <button class="modal-close" onclick="closeCoolingConfig()">âœ•</button>
            </div>
            <div class="modal-body">
                <table class="table" style="font-size:13px;">
                    <thead>
                        <tr>
                            <th>åœºæ™¯</th>
                            <th>å†·å´å¤©æ•°</th>
                            <th>é€‚ç”¨èŒƒå›´</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>æˆä¿¡æ‹’ç»</td>
                            <td><input type="number" value="30"
                                    style="width:60px;padding:4px 8px;border:1px solid #d9d9d9;border-radius:4px;"> å¤©
                            </td>
                            <td>è·¨æœºæ„</td>
                            <td><span class="status-badge status-success">å¯ç”¨</span></td>
                        </tr>
                        <tr>
                            <td>å®¢æˆ·æ˜ç¡®æ‹’ç»</td>
                            <td><input type="number" value="90"
                                    style="width:60px;padding:4px 8px;border:1px solid #d9d9d9;border-radius:4px;"> å¤©
                            </td>
                            <td>è·¨æœºæ„</td>
                            <td><span class="status-badge status-success">å¯ç”¨</span></td>
                        </tr>
                        <tr>
                            <td>é“¶è¡Œé€€å›</td>
                            <td><input type="number" value="15"
                                    style="width:60px;padding:4px 8px;border:1px solid #d9d9d9;border-radius:4px;"> å¤©
                            </td>
                            <td>è·¨æœºæ„</td>
                            <td><span class="status-badge status-success">å¯ç”¨</span></td>
                        </tr>
                        <tr>
                            <td>æ”¾æ¬¾å®Œæˆ</td>
                            <td><input type="number" value="365"
                                    style="width:60px;padding:4px 8px;border:1px solid #d9d9d9;border-radius:4px;"> å¤©
                            </td>
                            <td>åŒæœºæ„</td>
                            <td><span class="status-badge status-success">å¯ç”¨</span></td>
                        </tr>
                        <tr>
                            <td>åŒæœºæ„é‡æ¨</td>
                            <td><input type="number" value="180"
                                    style="width:60px;padding:4px 8px;border:1px solid #d9d9d9;border-radius:4px;"> å¤©
                            </td>
                            <td>åŒæœºæ„</td>
                            <td><span class="status-badge status-success">å¯ç”¨</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" onclick="closeCoolingConfig()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="closeCoolingConfig()">ä¿å­˜é…ç½®</button>
            </div>
        </div>
    </div>

    <script>
        // Mock æ•°æ®
        const mockData = [
            { id: 1, entId: '91320500MA1WXXX1', name: 'è‹å·åˆ›èŠ¯å¾®ç”µå­æœ‰é™å…¬å¸', region: 'è‹å·å¸‚', regionCode: '320500', status: 'CONTACTING', inst: 'æ±Ÿè‹é“¶è¡Œ', instId: 'jsbank', product: 'ç§‘æŠ€è´·', assignCount: 1, rejectCount: 0, coolingUntil: null, assignTime: '2026-02-08', score: 782 },
            { id: 2, entId: '91320100MA2BXXX2', name: 'å—äº¬æ™ºäº‘æ•°æ®ç§‘æŠ€æœ‰é™å…¬å¸', region: 'å—äº¬å¸‚', regionCode: '320100', status: 'AVAILABLE', inst: null, instId: null, product: null, assignCount: 2, rejectCount: 1, coolingUntil: null, assignTime: '2026-01-15', score: 756 },
            { id: 3, entId: '91320500MA3CXXX3', name: 'è‹å·æ’åŠ›ç²¾å¯†åˆ¶é€ æœ‰é™å…¬å¸', region: 'è‹å·å¸‚', regionCode: '320500', status: 'COOLING', inst: 'è‹å·å†œå•†è¡Œ', instId: 'szrcb', product: 'ç¨eè', assignCount: 3, rejectCount: 2, coolingUntil: '2026-03-10', assignTime: '2026-02-05', score: 712 },
            { id: 4, entId: '91320200MA4DXXX4', name: 'æ— é”¡å¤ªæ¹–æ–°èƒ½æºç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸', region: 'æ— é”¡å¸‚', regionCode: '320200', status: 'LOAN_SUCCESS', inst: 'æ±Ÿè‹é“¶è¡Œ', instId: 'jsbank', product: 'ç§‘æŠ€è´·', assignCount: 1, rejectCount: 0, coolingUntil: null, assignTime: '2026-01-20', score: 805, loanAmount: 300 },
            { id: 5, entId: '91320100MA5EXXX5', name: 'å—äº¬ç´«é‡‘å±±ç”Ÿç‰©åŒ»è¯æœ‰é™å…¬å¸', region: 'å—äº¬å¸‚', regionCode: '320100', status: 'INTERESTED', inst: 'å—äº¬é“¶è¡Œ', instId: 'njbank', product: 'å®åˆ›è´·', assignCount: 1, rejectCount: 0, coolingUntil: null, assignTime: '2026-02-06', score: 768 },
            { id: 6, entId: '91320400MA6FXXX6', name: 'å¸¸å·é¾™åŸæ™ºèƒ½è£…å¤‡æœ‰é™å…¬å¸', region: 'å¸¸å·å¸‚', regionCode: '320400', status: 'ASSIGNED', inst: 'æ±Ÿè‹é“¶è¡Œ', instId: 'jsbank', product: 'ç¨eè', assignCount: 1, rejectCount: 0, coolingUntil: null, assignTime: '2026-02-10', score: 734 },
            { id: 7, entId: '91320500MA7GXXX7', name: 'è‹å·å·¥ä¸šå›­åŒºé›†æˆç”µè·¯è®¾è®¡æœ‰é™å…¬å¸', region: 'è‹å·å¸‚', regionCode: '320500', status: 'CREDITED', inst: 'è‹å·å†œå•†è¡Œ', instId: 'szrcb', product: 'ç§‘åˆ›è´·', assignCount: 2, rejectCount: 1, coolingUntil: null, assignTime: '2026-02-01', score: 791 },
            { id: 8, entId: '91320600MA8HXXX8', name: 'å—é€šæµ·å·¥è£…å¤‡åˆ¶é€ æœ‰é™å…¬å¸', region: 'å—é€šå¸‚', regionCode: '320600', status: 'AVAILABLE', inst: null, instId: null, product: null, assignCount: 0, rejectCount: 0, coolingUntil: null, assignTime: null, score: 698 },
            { id: 9, entId: '91320100MA9IXXX9', name: 'å—äº¬æŸæ¶‰è¯‰ä¼ä¸šæœ‰é™å…¬å¸', region: 'å—äº¬å¸‚', regionCode: '320100', status: 'BLACKLISTED', inst: null, instId: null, product: null, assignCount: 1, rejectCount: 1, coolingUntil: null, assignTime: '2025-11-20', score: 320, blacklistReason: 'å¤šèµ·å¸æ³•è¯‰è®¼ï¼Œåˆ—å…¥å¤±ä¿¡è¢«æ‰§è¡Œäºº' },
            { id: 10, entId: '91320500MAAJXXA', name: 'è‹å·çº³ç±³æ–°ææ–™æœ‰é™å…¬å¸', region: 'è‹å·å¸‚', regionCode: '320500', status: 'COOLING', inst: 'æ±Ÿè‹é“¶è¡Œ', instId: 'jsbank', product: 'ç§‘æŠ€è´·', assignCount: 2, rejectCount: 1, coolingUntil: '2026-02-28', assignTime: '2026-01-28', score: 745 },
            { id: 11, entId: '91320200MABKXXB', name: 'æ— é”¡æƒ å±±åŒºç²¾å¯†æœºæ¢°æœ‰é™å…¬å¸', region: 'æ— é”¡å¸‚', regionCode: '320200', status: 'AVAILABLE', inst: null, instId: null, product: null, assignCount: 1, rejectCount: 1, coolingUntil: null, assignTime: '2025-12-10', score: 721 },
            { id: 12, entId: '91320100MACLXXC', name: 'å—äº¬æ±ŸåŒ—æ–°åŒºäººå·¥æ™ºèƒ½æœ‰é™å…¬å¸', region: 'å—äº¬å¸‚', regionCode: '320100', status: 'CONTACTING', inst: 'æŸå°è´·å…¬å¸A', instId: 'xlA', product: 'ä¿¡ç”¨è´·', assignCount: 3, rejectCount: 2, coolingUntil: null, assignTime: '2026-02-09', score: 668 },
        ];

        const statusMap = {
            'AVAILABLE': { label: 'å¯åˆ†é…', cls: 's-available' },
            'LOCKED': { label: 'å·²é”å®š', cls: 's-locked' },
            'ASSIGNED': { label: 'å·²åˆ†é…', cls: 's-assigned' },
            'CONTACTING': { label: 'è¥é”€ä¸­', cls: 's-contacting' },
            'INTERESTED': { label: 'æ„å‘ä¸­', cls: 's-interested' },
            'CREDITED': { label: 'å·²æˆä¿¡', cls: 's-credited' },
            'LOAN_SUCCESS': { label: 'å·²æ”¾æ¬¾', cls: 's-loaned' },
            'REJECTED': { label: 'å·²æ‹’ç»', cls: 's-rejected' },
            'COOLING': { label: 'å†·å´ä¸­', cls: 's-cooling' },
            'BLACKLISTED': { label: 'é»‘åå•', cls: 's-blacklisted' },
        };

        function renderTable(data) {
            const tbody = document.getElementById('poolTableBody');
            tbody.innerHTML = data.map(d => {
                const s = statusMap[d.status] || { label: d.status, cls: '' };
                const instHtml = d.inst ? `<span class="inst-tag">${d.inst}</span><br><span style="font-size:11px;color:#bfbfbf;">${d.product || ''}</span>` : '<span style="color:#bfbfbf;">-</span>';
                const coolingHtml = d.coolingUntil ? `<span class="cooling-info">æˆªè‡³ <span class="days-left">${d.coolingUntil}</span></span>` : '<span style="color:#d9d9d9;">-</span>';
                const assignTimeHtml = d.assignTime ? d.assignTime : '<span style="color:#d9d9d9;">ä»æœªåˆ†é…</span>';

                // æ“ä½œæŒ‰é’®æ ¹æ®çŠ¶æ€
                let actions = `<button class="btn btn-text btn-sm" onclick="openDrawer(${d.id})">è¯¦æƒ…</button>`;
                if (d.status === 'AVAILABLE') {
                    actions += `<button class="btn btn-text btn-sm" onclick="freezeEnt(${d.id})" style="color:#fa8c16;">å†»ç»“</button>`;
                    actions += `<button class="btn btn-text btn-sm" onclick="blacklistEnt(${d.id})" style="color:#f5222d;">æ‹‰é»‘</button>`;
                } else if (d.status === 'COOLING') {
                    actions += `<button class="btn btn-text btn-sm" onclick="releaseEnt(${d.id})" style="color:#52c41a;">é‡Šæ”¾</button>`;
                } else if (d.status === 'BLACKLISTED') {
                    actions += `<button class="btn btn-text btn-sm" onclick="unblacklist(${d.id})" style="color:#52c41a;">ç§»å‡º</button>`;
                }

                return `<tr>
                <td><div class="ent-name-cell"><span class="name">${d.name}</span><span class="code">${d.entId}</span></div></td>
                <td><span class="region-tag">${d.region}</span></td>
                <td><span class="pool-status ${s.cls}">${s.label}</span></td>
                <td>${instHtml}</td>
                <td><span class="assign-count">${d.assignCount}æ¬¡</span> / <span class="reject-count">${d.rejectCount}æ‹’</span></td>
                <td>${coolingHtml}</td>
                <td>${assignTimeHtml}</td>
                <td>${actions}</td>
            </tr>`;
            }).join('');
        }

        // ç­›é€‰
        function applyFilter() {
            const status = document.getElementById('filterStatus').value;
            const region = document.getElementById('filterRegion').value;
            const inst = document.getElementById('filterInst').value;
            const search = document.getElementById('searchInput').value.toLowerCase();
            let filtered = mockData.filter(d => {
                if (status && d.status !== status) return false;
                if (region && d.regionCode !== region) return false;
                if (inst && d.instId !== inst) return false;
                if (search && !d.name.toLowerCase().includes(search) && !d.entId.toLowerCase().includes(search)) return false;
                return true;
            });
            renderTable(filtered);
        }

        function resetFilter() {
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterRegion').value = '';
            document.getElementById('filterInst').value = '';
            document.getElementById('searchInput').value = '';
            renderTable(mockData);
        }

        // æŠ½å±‰è¯¦æƒ…
        function openDrawer(id) {
            const d = mockData.find(x => x.id === id);
            if (!d) return;
            const s = statusMap[d.status] || { label: d.status, cls: '' };
            document.getElementById('drawerTitle').textContent = d.name;

            // æ„å»ºè¯¦æƒ…å†…å®¹
            let html = `
            <div class="ent-header">
                <h4>${d.name}</h4>
                <div class="ent-meta">
                    <div class="ent-meta-item">ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼š<span>${d.entId}</span></div>
                    <div class="ent-meta-item">åœ°åŒºï¼š<span>${d.region}</span></div>
                    <div class="ent-meta-item">è‹ä¿¡åˆ†ï¼š<span>${d.score}</span></div>
                </div>
                <div style="margin-top:12px;">
                    å½“å‰çŠ¶æ€ï¼š<span class="pool-status ${s.cls}">${s.label}</span>
                    ${d.inst ? `&nbsp;&nbsp;å½“å‰æœºæ„ï¼š<span class="inst-tag">${d.inst}</span>` : ''}
                </div>
            </div>`;

            if (d.status === 'BLACKLISTED' && d.blacklistReason) {
                html += `<div style="background:#fff1f0;border:1px solid #ffa39e;border-radius:8px;padding:12px;margin-bottom:16px;font-size:13px;color:#a8071a;">
                âš ï¸ é»‘åå•åŸå› ï¼š${d.blacklistReason}
            </div>`;
            }

            if (d.coolingUntil) {
                html += `<div style="background:#f9f0ff;border:1px solid #d3adf7;border-radius:8px;padding:12px;margin-bottom:16px;font-size:13px;color:#722ed1;">
                â± å†·å´æœŸæˆªæ­¢ï¼š<strong>${d.coolingUntil}</strong>
            </div>`;
            }

            // æ¨¡æ‹Ÿåˆ†é…å†å²æ—¶é—´çº¿
            html += `<div class="section-title">ğŸ“‹ åˆ†é…å†å²</div><div class="timeline">`;
            if (d.assignCount >= 1 && d.assignTime) {
                html += `<div class="timeline-item${d.status === 'LOAN_SUCCESS' ? ' success' : ''}">
                <div class="tl-time">${d.assignTime}</div>
                <div class="tl-content">åˆ†é…ç»™ ${d.inst || 'æ±Ÿè‹é“¶è¡Œ'} - ${d.product || 'ç§‘æŠ€è´·'}</div>
                <div class="tl-detail">æ‰¹æ¬¡å· BATCH-20260208-001</div>
            </div>`;
            }
            if (d.status === 'CONTACTING') {
                html += `<div class="timeline-item warning"><div class="tl-time">${d.assignTime}</div><div class="tl-content">é“¶è¡Œç¡®è®¤è§¦è¾¾ï¼Œæ­£åœ¨è¥é”€ä¸­</div></div>`;
            }
            if (d.status === 'LOAN_SUCCESS') {
                html += `<div class="timeline-item success"><div class="tl-time">2026-02-15</div><div class="tl-content">æ”¾æ¬¾æˆåŠŸ Â¥${d.loanAmount}ä¸‡</div></div>`;
            }
            if (d.rejectCount > 0) {
                html += `<div class="timeline-item error"><div class="tl-time">2025-12-20</div><div class="tl-content">è¢«æ‹’ç»ï¼ˆä¸Šä¸€æ¬¡åˆ†é…ï¼‰</div><div class="tl-detail">æ‹’ç»åŸå› ï¼šé¢åº¦ä¸è¶³ / è¡Œä¸šé™åˆ¶</div></div>`;
            }
            if (d.assignCount === 0) {
                html += `<div class="timeline-item"><div class="tl-time">-</div><div class="tl-content">æš‚æ— åˆ†é…å†å²</div></div>`;
            }
            html += `</div>`;

            document.getElementById('drawerBody').innerHTML = html;
            document.getElementById('drawerOverlay').classList.add('active');
            document.getElementById('detailDrawer').classList.add('active');
        }

        function closeDrawer() {
            document.getElementById('drawerOverlay').classList.remove('active');
            document.getElementById('detailDrawer').classList.remove('active');
        }

        // æ“ä½œ
        function freezeEnt(id) { if (confirm('ç¡®è®¤å†»ç»“è¯¥ä¼ä¸šï¼Ÿå†»ç»“åå°†ä¸å‚ä¸åˆ†é…ã€‚')) showToast('å·²å†»ç»“'); }
        function releaseEnt(id) { if (confirm('ç¡®è®¤æå‰é‡Šæ”¾å†·å´æœŸï¼Ÿ')) showToast('å·²é‡Šæ”¾ï¼ŒçŠ¶æ€å˜ä¸ºå¯åˆ†é…'); }
        function blacklistEnt(id) { if (confirm('ç¡®è®¤åŠ å…¥é»‘åå•ï¼Ÿè¯¥ä¼ä¸šå°†æ°¸ä¹…ä¸å¯åˆ†é…ã€‚')) showToast('å·²åŠ å…¥é»‘åå•'); }
        function unblacklist(id) { if (confirm('ç¡®è®¤ç§»å‡ºé»‘åå•ï¼Ÿ')) showToast('å·²ç§»å‡ºé»‘åå•'); }
        function exportPool() { showToast('å¯¼å‡ºä»»åŠ¡å·²åˆ›å»º'); setTimeout(() => { if (confirm('å‰å¾€ä¸‹è½½ä¸­å¿ƒæŸ¥çœ‹ï¼Ÿ')) location.href = 'downloads.html'; }, 1500); }

        function showCoolingConfig() { document.getElementById('coolingModal').classList.add('active'); }
        function closeCoolingConfig() { document.getElementById('coolingModal').classList.remove('active'); }

        function showToast(msg) {
            const t = document.createElement('div');
            t.style.cssText = 'position:fixed;top:20px;right:20px;background:#52c41a;color:#fff;padding:12px 24px;border-radius:8px;z-index:9999;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.15);animation:fadeIn 0.3s;';
            t.textContent = 'âœ“ ' + msg;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 2500);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => renderTable(mockData));
    </script>
</body>

</html>